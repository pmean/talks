---
title: "The paired t-test"
editor: source
---

```{r}
#| label: 01-setup
#| message: false
#| warning: false

library(broom)
library(lme4)
library(tidyverse)
```


## Topic 1

-   No person can cross the same river twice
-   Run a true paired t-test
-   Outline effects in crossover (Senn 37-41)
    -   Period effects
    -   Period by Treatment interaction
    -   Carryover effect
    -   Patient by Treatment interaction
    -   Patient by Period interaction

::: notes

Speaker notes
:::

## Nice reference

Mills, E.J., Chan, AW., Wu, P. et al. Design, analysis, and presentation of crossover trials. Trials 10, 27 (2009). DOI: [10.1186/1745-6215-10-27][ref-mills-2009] 

[ref-mills-2009]: https://doi.org/10.1186/1745-6215-10-27

## Read

```{r}
#| label: setup-01
#| message: false
#| warning: false

library(broom)
library(lme4)
library(tidyverse)
```

```{r}
#| label: 01-read

couples <- read_tsv(
  file="../data/couples.txt",
  na=c("*",""),
  col_names=TRUE,
  col_types="cnnnn")
```

## Descriptive statistics on age gap

```{r}
#| label: 01-age-difference

couples |>
  summarize(
    mean_h_age=mean(hAge, na.rm=TRUE),
    sd_h_age=sd(hAge, na.rm=TRUE),
    n=sum(!is.na(hAge)))

couples |>
  summarize(
    mean_w_age=mean(wAge, na.rm=TRUE),
    sd_w_age=sd(wAge, na.rm=TRUE),
    n=sum(!is.na(wAge)))

couples |>
  mutate(age_gap=hAge-wAge) |>
  summarize(
    mean_age_gap=mean(age_gap, na.rm=TRUE),
    sd_age_gap=sd(age_gap, na.rm=TRUE),
    n=sum(!is.na(age_gap)))
```

## Paired t-test on couples ages

```{r}
t.test(couples$hAge, couples$wAge, paired=TRUE)
```

## Alternate way of testing

```{r}
#| label: pivot_ages

couples |>
  mutate(pair=sprintf("c%03d", 1:nrow(couples))) |>
  filter(!is.na(wAge)) |>
  filter(!is.na(hAge)) |>
  select(pair, wAge, hAge) |>
  pivot_longer(
    cols=c(wAge, hAge),
    names_to="spouse",
    values_to="age") |>
  mutate(spouse=str_sub(spouse, 1, 1)) -> couples_1

m2 <- lmer(age~spouse+(1|pair), data=couples_1) 
fixef(m2)
confint(m2, parm="spousew")
```
